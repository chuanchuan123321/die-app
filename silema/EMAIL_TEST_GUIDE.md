# 邮件发送测试指南

## 功能已添加 ✅

已为您添加**发送测试邮件**功能！

## 如何测试

### 步骤1: 配置SMTP服务器

在Flutter应用的设置页面填写：

#### 推荐使用Gmail（最简单）

**Gmail配置：**
- SMTP服务器：`smtp.gmail.com`
- 端口：`587`
- 用户名：`你的Gmail地址`
- 密码：**应用专用密码**（不是账号密码）

**获取Gmail应用专用密码：**
1. 访问 https://myaccount.google.com/security
2. 开启"两步验证"（如果未开启）
3. 搜索"应用专用密码"
4. 创建新密码（选择"邮件"）
5. 复制生成的16位密码

#### 其他邮箱选项

**QQ邮箱：**
- SMTP服务器：`smtp.qq.com`
- 端口：`465`
- 需要在邮箱设置中开启SMTP服务并获取授权码

**163邮箱：**
- SMTP服务器：`smtp.163.com`
- 端口：`465`
- 需要开启SMTP服务

**Outlook/Hotmail：**
- SMTP服务器：`smtp.office365.com`
- 端口：`587`
- 用户名：完整邮箱地址
- 密码：账号密码

### 步骤2: 保存SMTP配置

1. 填写完SMTP信息后
2. 点击"**保存SMTP配置**"按钮
3. 状态指示器会从"未配置"变为"已配置"（绿色）

### 步骤3: 发送测试邮件

1. 点击"**发送测试邮件**"按钮（青色边框按钮）
2. 系统会向您的紧急联系人邮箱发送一封测试邮件
3. 查看紧急联系人邮箱是否收到邮件

### 测试邮件内容

邮件包含：
- 发送人："死了吗"系统
- 收件人：您设置的紧急联系人邮箱
- 内容：模拟的警报邮件（显示已超过48小时未签到）

## 测试成功标准

✅ **成功指标：**
1. 点击"发送测试邮件"后，底部显示绿色提示："邮件已发送到 xxx@xxx.com"
2. 紧急联系人邮箱在1分钟内收到测试邮件
3. 邮件内容完整，包含用户信息和最后签到时间

❌ **失败情况：**
1. 显示"请先配置SMTP" - 需要先保存SMTP配置
2. 显示"发送失败" - 检查SMTP配置是否正确
3. 超过2分钟未收到邮件 - 检查垃圾邮件文件夹

## 常见问题

### Q: 点击发送测试邮件后没有反应？
**A:** 确保已经点击"保存SMTP配置"，状态显示为"已配置"

### Q: 显示"发送失败"？
**A:** 检查以下几点：
- SMTP服务器地址是否正确
- 端口号是否正确（587或465）
- 用户名是否是完整邮箱地址
- 密码是否正确（Gmail需要应用专用密码）

### Q: Gmail无法连接？
**A:**
1. 确保已开启两步验证
2. 使用应用专用密码，而不是账号密码
3. 检查是否允许"不够安全的应用访问"

### Q: 没收到邮件？
**A:**
1. 检查垃圾邮件文件夹
2. 等待2-3分钟（邮件可能有延迟）
3. 确认紧急联系人邮箱地址正确

## 调试技巧

**查看后端日志：**
```bash
# 查看实时日志
cat /tmp/claude/tasks/b5eb7f7.output | tail -20
```

**使用命令行测试：**
```bash
# 注册/登录获取token
TOKEN="your-jwt-token"

# 发送测试邮件
curl -X POST http://localhost:3000/api/auth/test-email \
  -H "Authorization: Bearer $TOKEN"
```

## 下一步

测试成功后：
1. ✅ SMTP配置已验证可用
2. ✅ 系统会每小时检查签到状态
3. ✅ 超过48小时未签到自动发送警报
4. ✅ 紧急联系人会收到通知邮件

## 安全提醒

⚠️ **重要：**
- 不要在代码中硬编码密码
- 定期更换SMTP密码
- 使用应用专用密码而非主密码
- 确保紧急联系人邮箱安全可靠
